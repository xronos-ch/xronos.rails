<!DOCTYPE html>
<html>
  <head>
    <title>Xronos</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag    'application', media: 'all' %>
    <%= javascript_include_tag 'application' %>

    <%= include_gon %>
  </head>

  <body>
          
  	<p class="notice"><%= notice %></p>
  	<p class="alert"><%= alert %></p>
  
		<!-- Foldout main navigation window -->
		<div class="burger_menu active">

			<button id="burger_nav_general" class="burger_nav-tgl" type="button" aria-label="toggle burger_menu">
				<span aria-hidden="true"></span>
			</button>

			<nav class="burger_nav">

        <button id="burger_nav_extend" type="button" aria-label="extend burger_menu">
          <%= fa_icon "expand" %>
        </button>

				<div id="content">

					<nav id="nav">
						<%= render_navigation renderer: :links %>
					</nav>

					<!-- #### Pages #### -->
					<main>

            <nav id="breadcrumbs_nav">
              <%= render_navigation renderer: :breadcrumbs, join_with: ' &gt; ' %>
            </nav>

						<% flash.each do |name, msg| %>
              <% if msg.is_a?(String) %>
						    <div id="flash_container">
							    <%= content_tag :div, msg %>
                </div>
             <% end %>
           <% end %>

  					<!-- #### Home #### -->
						<div id="Home" class="page default">
							
							<%= yield %>

              <hr>

						</div>

					</main>

			</nav>

		</div>

		<!-- #### Draggable console #### -->
		<div id = "controls">

			<div id="controls_login_status">
				<% if user_signed_in? %>
					<%= fa_icon "user" %> <% if current_user.admin? %> <%= fa_icon "legal" %> <% end %> <%= current_user.email[0...15] + "..." %> <br>
					<%= fa_icon "edit" %> <%= link_to('Edit registration', edit_user_registration_path) %> <br>
					<%= fa_icon "sign-out" %> <%= link_to('Logout', destroy_user_session_path, method: :delete) %> <br>
				<% else %>
					<%= fa_icon "sign-in" %> <%= link_to('Login', new_user_session_path) %> 
					<%= fa_icon "user-plus" %> <%= link_to('Register', new_user_registration_path) %> <br>
				<% end %>
			</div>

			<div id="controls_header">
				<h2>Filter console</h2>
			</div>

			<div id="controls_body">

        Spatial lasso selection: <br>
        <button id="toggleLasso"><%= fa_icon "circle-o-notch" %> Lasso</button>
        <button id="turnoffLasso"><%= fa_icon "times-circle" %> turn off</button>
        <% if session[:spatial_lasso_selection].present? || !(session[:spatial_lasso_selection].nil?) %>
          <%= fa_icon "check" %>
        <% else %>
          <%= fa_icon "times" %>
        <% end %>

        <%# site_types_array = SiteType.all.map { |x| [x.name, x.name] } %>
        <%# countries_array = Country.all.map { |x| [x.name, x.name] } %>

				<%= form_tag(root_path, method: "get") do %>
          <%= label_tag(:query_labnr, "Lab number:") %>
          <%= text_field_tag(:query_labnr, (session[:query_labnr] or "")) %>
          <%= label_tag(:query_site_name, "Site name:") %>
          <%= autocomplete_field_tag(:query_site_name, session[:query_site_name], data_autocomplete_site_name_path, 'data-delimiter' => ', ', multiple: true, 'data-auto-focus' => true) %>
          <%= label_tag(:query_site_type, "Site type:") %>
          <%= autocomplete_field_tag(:query_site_type, session[:query_site_type], data_autocomplete_site_type_name_path, 'data-delimiter' => ', ', multiple: true, 'data-auto-focus' => true) %>
          <%= label_tag(:query_country, "Country:") %>
          <%= autocomplete_field_tag(:query_country, session[:query_country], data_autocomplete_country_name_path, 'data-delimiter' => ', ', multiple: true) %>
          <%= label_tag(:query_feature, "Feature:") %>
          <%= text_field_tag(:query_feature, (session[:query_feature] or "")) %>
          <%= label_tag(:query_material, "Material:") %>
          <%= autocomplete_field_tag(:query_material, session[:query_material], data_autocomplete_material_name_path, 'data-delimiter' => ', ', multiple: true, 'data-auto-focus' => true) %>
          <%= label_tag(:query_species, "Species:") %>
          <%= text_field_tag(:query_species, (session[:query_species] or "")) %>
          <%= submit_tag("Filter") %>
				<% end %>

        <%= fa_icon "times" %> <%= link_to('Reset Filter', resetfilter_url) %>

			</div>

		</div>

		<!-- #### Background map #### -->
		<div id="background_map"></div>



  </body>
</html>
