<% content_for :title, @site.name %>

<header id="site-header" class="bg-primary text-light">
  <div class="container my-5">
    <h1 class="display-1"><%= @site.name %></h1>
    <h2 class="display-6">Site <% if @site.country.present? %> in <%= @site.country.common_name %><%end%></h2>
  </div>
</header>

<% unless @site.lat.blank? or @site.lng.blank? %>
  <section id="siteMap">
    <div style="height: 30rem; position: relative;"
         data-controller="map"
         data-map-style-value="show_site"
         data-map-target="container"
         data-map-base-map-value="Imagery"
         data-map-markers-data-value='<%= [@site].to_json.html_safe %>'>
    </div>
  </section>
<% end %>

<section id="site-details" class="bg-body">
  <div class="container my-5">
    <%= render "site_details", site: @site %>
    <% if can? :edit, Site %>
      <div class="text-end my-3">
        <%= link_to(edit_site_path, class: "btn btn-sm btn-primary", data: { "turbo_frame": "remote_modal" }) do %>
          <%= fa_icon "pencil", text: "Edit site details" %>
        <% end %>
      </div>
    <% end %>
  </div>
</section>

<section id="site-xrons" class="bg-light">
  <div class="container my-5">

    <% unless @c14s.nil? %>
      <section id="site-c14s" class="py-3">
        <h2><%= C14.label.humanize.pluralize %></h2>
        <p><%= @site.name %> has <%= pluralize(@c14s.count, C14.label) %>.</p>
        <%= render "c14s/table", c14s: @c14s %>
      </section>
    <%end%>

    <% unless @typos.nil? %>
      <section id="site-typos" class="py-3">
        <h2><%= Typo.label.humanize.pluralize %></h2>
        <p><%= @site.name %> has <%= pluralize(@typos.count, Typo.label) %>.</p>
        <%= render "typos/table", typos: @typos %>
      </section>
    <%end%>

  </div>
</section>

<section id="references" class="bg-body">
  <div class="container my-5">
    <h2>Bibliography</h2>
    <%= render "references/bibliography", 
      references: @site.recursive_references %>
</section>

<section id="xronos-metadata" class="bg-body">
  <div class="container my-5">

    <div class="my-3">
      <h2>XRONOS metadata</h2>
      <%= render "shared/record_metadata", record: @site, record_label: Site.label %>
    </div>

    <div class="my-3">
      <h2>Version history</h2>
      <%= render "application/paper_trail/versions", item: @site %>
    </div>

</section>

<% if can? :manage, Site %>
  <section id="show-curation" class="bg-light">
    <div class="container my-5">

      <h2>Curation</h2>

      <% if @site.is_duplicated? %>
        <div class="my-3">
          <h3>Potential duplicates</h3>
          <%= render "table", sites: @site.duplicates %>
        </div>
      <% end %>

    </div>
  </section>
<% end %>
